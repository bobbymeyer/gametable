<div class="mx-auto max-w-7xl px-4 py-8 text-left">
  <div class="mb-6 flex items-center justify-between">
    <div>
      <%= link_to "Series", series_index_path, class: "text-sm text-stone-600 dark:text-stone-400 hover:text-stone-800 dark:hover:text-stone-300" %>
      <h1 class="text-3xl font-bold text-stone-900 dark:text-white mt-1"><%= @series.name %></h1>
    </div>
    <% if @series.producer?(current_user) %>
      <div class="flex gap-2">
        <%= link_to "Edit", edit_series_path(@series), class: "border border-stone-400 dark:border-stone-600 px-4 py-2 text-sm font-medium text-stone-700 dark:text-stone-300 hover:bg-stone-200 dark:hover:bg-stone-800/50 transition-colors" %>
        <%= button_to "Delete", @series, method: :delete, data: { turbo_confirm: "Are you sure?" }, class: "border border-red-600 dark:border-red-800 px-4 py-2 text-sm font-medium text-red-700 dark:text-red-300 hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors" %>
        <% if @series.executive_producer?(current_user) %>
          <%= link_to "Manage producers", series_series_producers_path(@series), class: "border border-stone-400 dark:border-stone-600 px-4 py-2 text-sm font-medium text-stone-700 dark:text-stone-300 hover:bg-stone-200 dark:hover:bg-stone-800/50 transition-colors" %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if @series.description.present? %>
    <p class="text-stone-600 dark:text-stone-400 mb-8"><%= @series.description %></p>
  <% end %>

  <div role="tablist" aria-label="Series sections" class="border-b border-stone-200 dark:border-stone-700 mb-6">
    <div class="flex gap-1 -mb-px">
      <%= link_to "Cast", series_path(@series, anchor: "cast"), role: "tab", id: "tab-cast", aria: { selected: "false", controls: "cast" }, class: "series-tab border-b-2 border-transparent px-4 py-3 text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-200 hover:border-stone-300 dark:hover:border-stone-600 transition-colors" %>
      <%= link_to "Episodes", series_path(@series, anchor: "episodes"), role: "tab", id: "tab-episodes", aria: { selected: "false", controls: "episodes" }, class: "series-tab border-b-2 border-transparent px-4 py-3 text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-200 hover:border-stone-300 dark:hover:border-stone-600 transition-colors" %>
      <%= link_to "Locations", series_path(@series, anchor: "locations"), role: "tab", id: "tab-locations", aria: { selected: "false", controls: "locations" }, class: "series-tab border-b-2 border-transparent px-4 py-3 text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-200 hover:border-stone-300 dark:hover:border-stone-600 transition-colors" %>
      <%= link_to "Future", series_path(@series, anchor: "future"), role: "tab", id: "tab-future", aria: { selected: "false", controls: "future" }, class: "series-tab border-b-2 border-transparent px-4 py-3 text-sm font-medium text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-200 hover:border-stone-300 dark:hover:border-stone-600 transition-colors" %>
    </div>
  </div>

  <div id="cast" role="tabpanel" aria-labelledby="tab-cast" class="series-panel hidden">
    <%= render "cast_tab" %>
  </div>
  <div id="episodes" role="tabpanel" aria-labelledby="tab-episodes" class="series-panel hidden">
    <%= render "episodes_tab" %>
  </div>
  <div id="locations" role="tabpanel" aria-labelledby="tab-locations" class="series-panel hidden">
    <%= render "locations_tab" %>
  </div>
  <div id="future" role="tabpanel" aria-labelledby="tab-future" class="series-panel hidden">
    <%= render "future_tab" %>
  </div>
</div>

<script>
(function() {
  var TAB_IDS = [ "cast", "episodes", "locations", "future" ];
  var defaultTab = "cast";

  function hashToTab() {
    var hash = (window.location.hash || "#").slice(1).toLowerCase();
    return TAB_IDS.includes(hash) ? hash : defaultTab;
  }

  function showTab(tabId) {
    TAB_IDS.forEach(function(id) {
      var panel = document.getElementById(id);
      var tab = document.getElementById("tab-" + id);
      if (!panel || !tab) return;
      if (id === tabId) {
        panel.classList.remove("hidden");
        tab.setAttribute("aria-selected", "true");
        tab.classList.add("border-amber-500", "text-amber-600", "dark:text-amber-400");
        tab.classList.remove("border-transparent");
      } else {
        panel.classList.add("hidden");
        tab.setAttribute("aria-selected", "false");
        tab.classList.remove("border-amber-500", "text-amber-600", "dark:text-amber-400");
        tab.classList.add("border-transparent");
      }
    });
  }

  function syncFromHash() {
    showTab(hashToTab());
  }

  document.querySelectorAll(".series-tab").forEach(function(link) {
    link.addEventListener("click", function(e) {
      var anchor = link.getAttribute("href").split("#")[1] || defaultTab;
      if (anchor && TAB_IDS.includes(anchor)) {
        window.location.hash = anchor;
        showTab(anchor);
        e.preventDefault();
      }
    });
  });

  window.addEventListener("hashchange", syncFromHash);
  syncFromHash();
})();
</script>
